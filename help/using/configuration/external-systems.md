---
solution: Journey Optimizer
product: journey optimizer
title: 外部システム ps との間で、旅のオプティマイザーを統合
description: 外部システムとの旅オプティマイザーを統合する際のベストプラクティスについて説明します。
role: User
level: Beginner
exl-id: 27859689-dc61-4f7a-b942-431cdf244455
source-git-commit: 021cf48ab4b5ea8975135a20d5cef8846faa5991
workflow-type: tm+mt
source-wordcount: '1052'
ht-degree: 0%

---

# 外部システムとの統合 {#external-systems}

このページでは、外部システムを統合する際に、次のような優れた guardrails を提供しています。また、読み取り方法、「上限」を使用して外部システムの保護を最適化する方法、旅のタイムアウトを設定する方法、および再試行の動作についても説明します。

旅のオプティマイザーを使用すると、カスタムデータソースやカスタムアクションを使用して、外部システムとの接続を設定することができます。 これにより、例えば、外部予約システムから送られるデータを使用して journeys を強化したり、他のシステムを使用してメッセージを送信したりすることができます。

外部システムを統合する際には、いくつかの問題が発生したり、システムの速度が遅くなったり、応答を停止したりすることができます。また、大規模なボリュームを処理できないことがあります。 旅オプティマイザーには、システムの過剰な負荷を防止するための複数の gu: rails が用意されています。

すべての外部システムは、パフォーマンスの点で異なります。 この設定は、ユースケースに合わせる必要があります。

次のように、旅のオプティマイザーが外部 API に対する呼び出しを実行すると、テクニカル guの処理が実行されます。

1. 上限値に達した場合は、残りの呼び出しが破棄されます。

2. タイムアウト後、再試行: 上限ルールが満たされている場合は、タイムアウト期間が終了するまで呼び出しを実行しようとします。

## 上限{#capping}

ビルトインの上限技術は、外部システムを保護するために使用されます。

外部データソースについては、1秒あたりの呼び出し回数の最大値は15に設定されています。 呼び出し回数が1秒あたり15を超える場合は、残りの呼び出しが破棄されます。 この制限値は、プライベートな外部データソースによって増加させることができます。 Allowlist にエンドポイントが含まれるように、アドビシステムズ社にお問い合わせください。 これは、パブリック外部データソースには使用できません。

カスタムアクションについては、外部 API の容量を検証する必要があります。 例えば、旅のオプティマイザーが1秒間に1000呼び出しを送信した場合、システムでは1秒あたり100呼び出ししかサポートされていないので、上限ルールを定義してシステムが飽和状態にならないようにする必要があります。

上限規則は、特定のエンドポイント (URL) に対するサンドボックスレベルで定義されます。 実行時に、処理オプティマイザーによって、上限が定義されているかどうかが確認され、そのエンドポイントへの呼び出し中に定義されたレートが適用されます。 呼び出し数が定義されたレートを超えると、残りの呼び出しが破棄され、報告時にエラーとしてカウントされます。

ソリッド化規則は1つのエンドポイントに固有ですが、サンドボックスのすべての journeys に対してグローバルです。 これは、すべての journeys がサンドボックスの間で共有されていることを意味します。

例えば、外部システムに対して1秒間に100呼び出しの上限規則が定義されているとします。 このシステムは、10個の異なる journeys にあるカスタムアクションによって呼び出されます。 1秒間に200の呼び出しを受信する100と、使用可能な100スロットが使用されます。 最大レートを超えているので、他の 9 journeys では、左に1つのスロットが表示されることはありません。 この粒度によって、外部システムが過剰にロードされ、クラッシュするのを防ぐことができます。

「上限」 API および「上限」の設定方法について詳しくは、「旅のオーケストレーション ](https://experienceleague.adobe.com/docs/journeys/using/working-with-apis/capping.html) について」を参照してください {target = &quot;_blank 「}」を [ 参照してください。

## タイムアウトとリトライ{#timeout}

ソリッドルールが満たされている場合は、タイムアウトルールが適用されます。

各旅において、タイムアウト期間を定義することができます。 これにより、外部システムの呼び出し時に最大継続時間を設定することができます。 タイムアウト期間は、フライトのプロパティで設定します。 このページ ](../building-journeys/journey-gs.md#timeout_and_error) を [ 参照してください。

このタイムアウトはすべての外部呼び出し (カスタムアクションおよびカスタムデータソースの外部 API 呼び出し) にグローバルに設定されます。 デフォルトでは、この値は5秒に設定されています。

指定されたタイムアウト期間中、外部システムの呼び出しが試みられます。 最初の呼び出しが完了すると、タイムアウト時間が経過するまでは、最大で3回リトライすることができます。 再試行回数を変更することはできません。

リトライは、1スロットを使用します。 1秒間に100個の呼び出しがあり、各呼び出しに2回のリトライが必要な場合には、1秒間に30回の呼び出しを使用します。各呼び出しは、1秒間に約3つのスロットを使用します。

タイムアウト期間の値は、ユースケースによって異なります。 例えば、クライアントがストアに入力したときにメッセージを迅速に送信する場合は、長いタイムアウトを設定する必要はありません。 また、タイムアウトが長いほど、キューに追加されるアイテム数は増えます。 これは、パフォーマンスに大きく影響します。 1秒あたり1000の呼び出しが実行される場合、データの 5 ~ 15 秒の保持によってシステムが急速に過負荷になります。

次の例では、タイムアウトは5秒になります。

* 最初の呼び出しが5秒以内に継続されます。呼び出しは成功し、再試行は実行されません。
* 最初の呼び出しは5秒間継続します。呼び出しはキャンセルされ、再試行は実行されません。 これは、レポートのタイムアウトエラーになります。
* 最初の呼び出しは2秒後に失敗します (外部システムはエラーを返します)。3秒が経過するのは、「上限」スロットが使用可能な場合です。
   * この3秒が経過する前に再試行が成功した場合は、その呼び出しが実行されるので、エラーは発生しません。
   * リトライ中、タイムアウト時間が経過すると、その呼び出しはキャンセルされ、タイムアウトエラーがレポートに含まれていると見なされます。

## よく寄せられる質問{#faq}

**どのようにして、上限ルールを設定することができますか? デフォルトの上限規則があるかどうかを確認します。**

デフォルトでは、上限規則はありません。 上限規則は、「上限」 API を使用して特定のエンドポイント (URL) のサンドボックスレベルで定義されています。 このセクション ](../configuration/external-systems.md#capping) と、 [ 旅のオーケストレーションのマニュアル ](https://experienceleague.adobe.com/docs/journeys/using/working-with-apis/capping.html) {target = &quot;_blank&quot;} を [ 参照してください。

**実行される再試行の回数を確認します。 リトライの回数を変更するか、またはリトライの間に最低限の待機時間を指定することはできますか?**

指定された呼び出しについては、最初の呼び出しの後に最大で3回リトライできます。これは、タイムアウト期間が終了するまでです。 リトライの回数と各リトライ間の時間を変更することはできません。 この項 ](../configuration/external-systems.md#timeout) を [ 参照してください。

**タイムアウトを設定するにはどうすればよいですか? 最大値を指定してください。**

各旅において、タイムアウト期間を定義することができます。 タイムアウト期間は、フライトのプロパティで設定します。 タイムアウトには、1秒から30秒の間の値を指定する必要があります。 このセクション ](../configuration/external-systems.md#timeout) および [ このページ ](../building-journeys/journey-gs.md#timeout_and_error) を [ 参照してください。